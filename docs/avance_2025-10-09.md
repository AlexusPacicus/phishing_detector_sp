# 📅 Avance – 2025-10-09

## ✅ Trabajo realizado

### 1. Sistema de Scoring – v1
- Implementado **sistema heurístico de scoring** para priorizar URLs orientadas a España.
- Reglas basadas en:
  - **Geográfico**: `.es`, `.com.es`, `+34`, `€`.
  - **Lingüístico**: tokens castellanos (`cliente`, `pago`, `multa`, etc.).
  - **Marcas nacionales**: `bbva`, `santander`, `caixabank`, `ing`, `correos`, etc.
  - **Hosting gratuito/local**: `webcindario`, `rf.gd`, etc.
  - **Fuzzy matching** con dominios `.es` de referencia.
  - **Penalizaciones**: TLDs LATAM, tokens en portugués.
- **Umbrales de uso**:
  - `score_total ≥ 2` → URL orientada a España.
  - `score_total ≥ 7` → candidata a dataset phishing en español (alta confianza).
- Resultado: **236 URLs** procesadas → **69 seleccionadas (inclusión=1)** tras validación manual.

---

### 2. Features finales
- Consolidada función `extract_features(url)` en `scripts/features.py`.
- **10 features implementadas**, coherentes con `features.md`:
  - **Fuertes:** `protocol`, `tld_group`, `trusted_path_token`, `num_params`, `contains_equal`.
  - **Moderadas:** `domain_length`, `domain_entropy`, `suspicious_path_token`.
  - **Específicas:** `contains_percent`, `free_hosting`.
- Generado `features_inclusion1.csv` con las 69 URLs seleccionadas + features.

---

### 3. Validación del modelo
- Modelo: **Logistic Regression** (`logreg_phishing_final.joblib`, con threshold propio).
- Dataset de prueba: **69 URLs (inclusión=1)**.
- Resultados:
  - **TP (phishing detectado):** 60  
  - **FN (falsos negativos):** 9  
  - **Recall:** 0.87  
  - **Precision:** 1.0  
  - **F1-score:** 0.93  
  - **Accuracy:** 0.87  

Matriz de confusión:
[[ 0 0]
[ 9 60]]

---

### 4. Análisis de fallos
URLs clasificadas erróneamente como legítimas:
- `area.clientes-ingdiirect.es-eu.org` → tokens legitimadores (`clientes`, `login`).  
- `bancosantander.es.hotelparadis.es/...` → exceso de confianza en `.es`.  
- `correosprepago.bnext.es/...` → dominio fintech legítimo, difícil de discriminar.  
- `draganov-8bb38d.ingress-erytho.easywp.com/...` → free hosting no incluido en lista.  
- `ivresse.com/.../ionosv2/...` → dominio base legítimo, sin señales fuertes.  
- `msantamobs.com/.../correos.es...` → marca en path no detectada.  
- `wififpt.com.vn/.../bankia.es/...` → TLD sospechoso, pero tokens legitimadores en ruta.  
- `servicio-ing.es/.../login` → `.es` + token de confianza.

**Patrones comunes de error:**
- Confianza excesiva en `.es`.  
- Tokens “legitimadores” en rutas.  
- Marcas ocultas en path.  
- Free hosting incompleto.  
- Confusión con dominios borderline.

---

### 5. Próximos pasos
- 🔧 Refinar `trusted_path_token` → aplicar sólo en dominio principal, no en rutas.  
- 🔧 Ampliar `suspicious_path_token` → incluir `avisos`, `wp-admin`, `user`, `mail`, `acceso`.  
- 🔧 Ampliar `free_hosting` → añadir `easywp.com`, `000webhost.com`, etc.  
- 🔧 Nueva feature: `brand_in_path` → detectar marcas en rutas.  
- 🔧 Validar scoring + modelo sobre un dataset mixto (phishing vs legítimas).  

---

## 🧭 Reflexión del día
- Se completó la **v1 del sistema de scoring** y se documentó su justificación.  
- Se consolidó la función `extract_features(url)` con las 10 features finales.  
- El modelo baseline Logistic Regression alcanza **alta precisión (1.0)** pero con **recall limitado (0.87)**.  
- Los falsos negativos identificados dan una hoja de ruta clara para mejorar.  
- Proyecto cierra el día con **pipeline end-to-end funcionando** y documentación coherente.

---
